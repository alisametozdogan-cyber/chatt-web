<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Chatt Web - Discord Klon</title>
<style>
body { margin:0; font-family:'Segoe UI',sans-serif; display:flex; height:100vh; background:#36393f; color:white; }
#sidebar { width:250px; background:#2f3136; display:flex; flex-direction:column; padding:15px; }
#logo { text-align:center; font-size:22px; font-weight:bold; margin-bottom:15px; color:#7289da; }
#users { flex:1; overflow-y:auto; margin-top:10px; }
.user { padding:8px 10px; border-radius:5px; margin:5px 0; background:#40444b; cursor:pointer; display:flex; justify-content:space-between; align-items:center; }
.user.admin { background:#ff4757; }
.user:hover { background:#5865f2; }
#main { flex:1; display:flex; flex-direction:column; position:relative; }
#chat { flex:1; overflow-y:auto; padding:10px; }
.msg { background:#40444b; padding:8px 10px; border-radius:5px; margin:5px 0; display:flex; justify-content:space-between; align-items:center; }
.msg.admin { border:2px solid #ff4757; }
.msg button { background:#ff4d4d; border:none; padding:2px 6px; border-radius:5px; cursor:pointer; }
.msg button:hover { background:#ff1a1a; }
#input-container { display:flex; padding:10px; gap:5px; background:#2f3136; }
#input-container input { flex:1; padding:8px; border-radius:5px; border:none; }
#input-container button { padding:8px 12px; border-radius:5px; border:none; background:#7289da; color:white; cursor:pointer; }
#input-container button:hover { background:#5b6eae; }
/* Modal login */
#loginModal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:flex; justify-content:center; align-items:center; z-index:999; }
#loginModal .modal-content { background:#2f3136; padding:20px; border-radius:10px; display:flex; flex-direction:column; gap:10px; width:300px; }
#loginModal input { padding:8px; border-radius:5px; border:none; width:100%; }
#loginModal button { padding:8px; border-radius:5px; border:none; background:#7289da; color:white; cursor:pointer; }
#loginModal button:hover { background:#5b6eae; }
</style>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js"></script>
</head>
<body>

<div id="sidebar">
  <div id="logo">ðŸ”¥ Chatt Web</div>
  <div id="users"></div>
</div>

<div id="main">
  <div id="chat"></div>
  <div id="input-container">
    <input id="message" placeholder="Mesaj yaz..." disabled>
    <button id="sendBtn" disabled>GÃ¶nder</button>
    <button id="voiceBtn" disabled>Sesli Sohbete KatÄ±l</button>
  </div>
</div>

<!-- Modal login -->
<div id="loginModal">
  <div class="modal-content">
    <h3>GiriÅŸ / KayÄ±t</h3>
    <input id="loginUsername" placeholder="KullanÄ±cÄ± adÄ±">
    <input id="loginPassword" type="password" placeholder="Åžifre">
    <input id="loginNickname" placeholder="Nickname">
    <button id="loginBtn">GiriÅŸ Yap / KayÄ±t Ol</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, push, onChildAdded, remove, onChildRemoved, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBhZF2igk9MZF-UEVYQEJl9N6IhMAeRsLU",
  authDomain: "chatt-5c23d.firebaseapp.com",
  databaseURL: "https://chatt-5c23d-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "chatt-5c23d",
  storageBucket: "chatt-5c23d.appspot.com",
  messagingSenderId: "307426902187",
  appId: "1:307426902187:web:6bb314fe10261a1733b7ee"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Login / KayÄ±t
let username, nickname, isAdmin=false;
const loginModal = document.getElementById("loginModal");
document.getElementById("loginBtn").onclick = ()=>{
  username = document.getElementById("loginUsername").value.trim();
  const password = document.getElementById("loginPassword").value.trim();
  nickname = document.getElementById("loginNickname").value.trim();
  if(!username || !password || !nickname) return alert("TÃ¼m alanlarÄ± doldurun!");

  // Aloak1 admin kontrol
  if(username==="Aloak1" && password!=="1234") return alert("YanlÄ±ÅŸ ÅŸifre!");
  if(username==="Aloak1") isAdmin=true;

  loginModal.style.display="none";
  document.getElementById("message").disabled=false;
  document.getElementById("sendBtn").disabled=false;
  document.getElementById("voiceBtn").disabled=false;

  // KullanÄ±cÄ±yÄ± Firebase ekle
  const userRef = ref(db,"users/"+username);
  push(userRef,{nickname, admin:isAdmin, online:true});
}

// Chat
const chatDiv = document.getElementById("chat");
window.sendMessage = ()=>{
  const messageInput = document.getElementById("message");
  const text = messageInput.value.trim();
  if(!text) return;
  // Basit kÃ¼fÃ¼r filtresi
  const banned = ["badword1","badword2"];
  let filteredText = text;
  banned.forEach(word=>{
    const regex = new RegExp(word,"gi");
    filteredText = filteredText.replace(regex,"***");
  });
  push(ref(db,"messages"), {user: username, nickname, text: filteredText, uid: username});
  messageInput.value="";
}

window.deleteMessage = (msg)=>{
  if(msg.uid===username || isAdmin) remove(ref(db,"messages/"+msg.id));
}

// Mesaj ekleme
onChildAdded(ref(db,"messages"), snapshot=>{
  const msg = snapshot.val();
  const id = snapshot.key;
  const div = document.createElement("div");
  div.className="msg";
  if(msg.user==="Aloak1") div.classList.add("admin");
  div.id="msg-"+id;
  if(msg.uid===username || isAdmin){
    div.innerHTML=`<span><b>${msg.nickname}:</b> ${msg.text}</span> <button onclick="deleteMessage({id:'${id}',uid:'${msg.uid}'})">Sil</button>`;
  } else {
    div.innerHTML=`<span><b>${msg.nickname}:</b> ${msg.text}</span>`;
  }
  chatDiv.appendChild(div);
  chatDiv.scrollTop=chatDiv.scrollHeight;
});

// Mesaj silme
onChildRemoved(ref(db,"messages"), snapshot=>{
  const div = document.getElementById("msg-"+snapshot.key);
  if(div) div.remove();
});

// KullanÄ±cÄ± listesi
const usersDiv = document.getElementById("users");
onValue(ref(db,"users"), snapshot=>{
  usersDiv.innerHTML="";
  snapshot.forEach(child=>{
    const uname = child.key;
    const data = child.val();
    const div = document.createElement("div");
    div.className="user";
    if(data.admin) div.classList.add("admin");
    div.innerText=data.nickname;
    usersDiv.appendChild(div);
  });
});

// Event listeners
document.getElementById("sendBtn").addEventListener("click", sendMessage);
document.getElementById("message").addEventListener("keypress", e=>{ if(e.key==="Enter") sendMessage(); });
document.getElementById("voiceBtn").onclick=()=>{ alert("Sesli sohbet demo aÃ§Ä±ldÄ±!"); }

</script>

</body>
</html>
