<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Pico Park Fix</title>
    <style>
        body { margin: 0; background: #1a1a1a; display: flex; justify-content: center; align-items: center; height: 100vh; color: white; font-family: sans-serif; }
        #menu { background: #333; padding: 20px; border-radius: 10px; text-align: center; }
        input { display: block; margin: 10px auto; padding: 10px; border-radius: 5px; border: none; }
        button { padding: 10px 20px; background: #27ae60; color: white; border: none; cursor: pointer; border-radius: 5px; }
        canvas { background: #fff; border: 5px solid #555; display: none; }
    </style>
</head>
<body>

    <div id="menu">
        <h2>PICO PARK CLONE</h2>
        <input type="text" id="pName" placeholder="Adın">
        <input type="text" id="rName" placeholder="Oda Adı">
        <button id="joinBtn">OYUNA KATIL</button>
        <p id="status" style="font-size: 12px; color: #e74c3c;"></p>
    </div>

    <canvas id="gameCanvas" width="800" height="400"></canvas>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, onDisconnect } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // !!! BURAYI DOLDURMAZSAN OYUN BAŞLAMAZ !!!
        const firebaseConfig = {
            apiKey: "BURAYA_KENDI_ANAHTARIN",
            authDomain: "PROJE_ADIN.firebaseapp.com",
            databaseURL: "https://PROJE_ADIN-default-rtdb.firebaseio.com",
            projectId: "PROJE_ADIN",
            storageBucket: "PROJE_ADIN.appspot.com",
            appId: "..."
        };

        const joinBtn = document.getElementById("joinBtn");
        const status = document.getElementById("status");

        joinBtn.onclick = () => {
            if(firebaseConfig.apiKey === "BURAYA_KENDI_ANAHTARIN") {
                status.innerText = "Hata: Önce Firebase ayarlarını kodun içine yapıştırmalısın!";
                return;
            }

            try {
                const app = initializeApp(firebaseConfig);
                const db = getDatabase(app);
                startGame(db);
            } catch (e) {
                status.innerText = "Firebase Bağlantı Hatası!";
                console.error(e);
            }
        };

        function startGame(db) {
            document.getElementById("menu").style.display = "none";
            const canvas = document.getElementById("gameCanvas");
            canvas.style.display = "block";
            const ctx = canvas.getContext("2d");

            const myId = "p" + Math.floor(Math.random() * 1000);
            const room = document.getElementById("rName").value || "genel";
            const pName = document.getElementById("pName").value || "Oyuncu";
            
            let players = {};
            let myPos = { x: 100, y: 300, color: "red", name: pName };

            const roomRef = ref(db, `rooms/${room}/players/${myId}`);
            set(roomRef, myPos);
            onDisconnect(roomRef).remove();

            onValue(ref(db, `rooms/${room}/players`), (snap) => {
                players = snap.val() || {};
            });

            // Hareket
            window.onkeydown = (e) => {
                if(e.key === "ArrowRight") myPos.x += 10;
                if(e.key === "ArrowLeft") myPos.x -= 10;
                set(roomRef, myPos);
            };

            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                Object.values(players).forEach(p => {
                    ctx.fillStyle = p.color;
                    ctx.fillRect(p.x, p.y, 40, 40);
                    ctx.fillStyle = "black";
                    ctx.fillText(p.name, p.x, p.y - 5);
                });
                requestAnimationFrame(draw);
            }
            draw();
        }
    </script>
</body>
</html>
