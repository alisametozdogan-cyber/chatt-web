<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Chatt Discord Klon</title>
<style>
  /* Genel gÃ¶vde ve font */
  body { margin:0; font-family:'Segoe UI', sans-serif; display:flex; height:100vh; background:#36393f; color:white; }
  
  /* Sol panel */
  #sidebar { width:250px; background:#2f3136; display:flex; flex-direction:column; padding:15px; }
  #logo { text-align:center; font-size:22px; font-weight:bold; margin-bottom:15px; color:#7289da; }
  #users { flex:1; overflow-y:auto; margin-top:10px; }
  .user { padding:8px 10px; border-radius:5px; margin:5px 0; background:#40444b; cursor:pointer; display:flex; justify-content:space-between; align-items:center; }
  .user.admin { background:#ff4757; }
  .user:hover { background:#5865f2; }
  
  /* Ana alan */
  #main { flex:1; display:flex; flex-direction:column; }
  #chat { flex:1; overflow-y:auto; padding:10px; }
  .msg { background:#40444b; padding:8px 10px; border-radius:5px; margin:5px 0; display:flex; justify-content:space-between; align-items:center; }
  .msg.admin { border:2px solid #ff4757; }
  .msg button { background:#ff4d4d; border:none; padding:2px 6px; border-radius:5px; cursor:pointer; }
  .msg button:hover { background:#ff1a1a; }
  
  /* Mesaj input */
  #input-container { display:flex; padding:10px; gap:5px; background:#2f3136; }
  #input-container input { flex:1; padding:8px; border-radius:5px; border:none; }
  #input-container button { padding:8px 12px; border-radius:5px; border:none; background:#7289da; color:white; cursor:pointer; }
  #input-container button:hover { background:#5b6eae; }
  
  /* Ses butonu */
  #voiceBtn { margin-top:10px; background:#1abc9c; }
  #voiceBtn:hover { background:#16a085; }
</style>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js"></script>
</head>
<body>

<div id="sidebar">
  <div id="logo">ðŸ”¥ Chatt Web</div>
  <div id="users"></div>
</div>

<div id="main">
  <div id="chat"></div>
  <div id="input-container">
    <input id="message" placeholder="Mesaj yaz...">
    <button id="sendBtn">GÃ¶nder</button>
    <button id="voiceBtn">Sesli Sohbete KatÄ±l</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, push, onChildAdded, remove, onChildRemoved, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

// Firebase ayarlarÄ±
const firebaseConfig = {
  apiKey: "AIzaSyBhZF2igk9MZF-UEVYQEJl9N6IhMAeRsLU",
  authDomain: "chatt-5c23d.firebaseapp.com",
  databaseURL: "https://chatt-5c23d-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "chatt-5c23d",
  storageBucket: "chatt-5c23d.firebasestorage.app",
  messagingSenderId: "307426902187",
  appId: "1:307426902187:web:6bb314fe10261a1733b7ee"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Admin username
const adminUser = "Admin001";

// Rastgele kullanÄ±cÄ± oluÅŸtur
let username = prompt("KullanÄ±cÄ± adÄ±nÄ±zÄ± girin:");
if(!username) username = "User" + Math.floor(Math.random()*10000);

// Admin kontrolÃ¼
const isAdmin = username === adminUser;

// KullanÄ±cÄ±yÄ± Firebaseâ€™de tut
const usersRef = ref(db, "users/" + username);
push(usersRef, {online:true, admin:isAdmin});

// Ã–rnek mesajlar (uygulama boÅŸ gÃ¶rÃ¼nmesin diye)
const exampleMessages = [
  {user:"User123", text:"Merhaba!"},
  {user:"User456", text:"Selam, nasÄ±lsÄ±nÄ±z?"},
  {user:adminUser, text:"Ben adminim, tÃ¼m mesajlarÄ± silebilirim!"}
];
exampleMessages.forEach(msg => push(ref(db, "messages"), msg));

// Chat ve mesaj silme
const chatDiv = document.getElementById("chat");

window.sendMessage = function(){
  const message = document.getElementById("message").value.trim();
  if(message){
    push(ref(db, "messages"), {user:username, text:message});
    document.getElementById("message").value = "";
  }
}

window.deleteMessage = function(msgId, msgUser){
  if(msgUser === username || isAdmin){
    remove(ref(db, "messages/" + msgId));
  } else {
    alert("Sadece kendi mesajÄ±nÄ±zÄ± silebilirsiniz!");
  }
}

// Mesaj ekleme
onChildAdded(ref(db, "messages"), (data)=>{
  const msg = data.val();
  const id = data.key;
  const p = document.createElement("div");
  p.className = "msg";
  if(msg.user === adminUser) p.classList.add("admin");
  p.id = "msg-" + id;
  if(msg.user === username || isAdmin){
    p.innerHTML = `<span><b>${msg.user}:</b> ${msg.text}</span>
                   <button onclick="deleteMessage('${id}','${msg.user}')">Sil</button>`;
  } else {
    p.innerHTML = `<span><b>${msg.user}:</b> ${msg.text}</span>`;
  }
  chatDiv.appendChild(p);
  chatDiv.scrollTop = chatDiv.scrollHeight;
});

// Mesaj silme anÄ±nda ekranÄ± gÃ¼ncelle
onChildRemoved(ref(db, "messages"), (data)=>{
  const id = data.key;
  const msgDiv = document.getElementById("msg-" + id);
  if(msgDiv) msgDiv.remove();
});

// KullanÄ±cÄ± listesi
const usersDiv = document.getElementById("users");
onValue(ref(db, "users"), (snapshot)=>{
  usersDiv.innerHTML = "";
  snapshot.forEach(child=>{
    const uname = child.key;
    const data = child.val();
    const div = document.createElement("div");
    div.className = "user";
    if(data.admin) div.classList.add("admin");
    div.innerText = uname;
    usersDiv.appendChild(div);
  });
});

// Sesli sohbet basit demo (WebRTC Ã§oklu kanal iÃ§in hazÄ±r)
const voiceBtn = document.getElementById("voiceBtn");
voiceBtn.onclick = async () => {
  alert("Sesli sohbet demo: Bu butona basÄ±nca mikrofon aÃ§Ä±lÄ±r (tek kanalda) ve ses akÄ±ÅŸÄ± yapÄ±labilir.");
}

// Event listeners
document.getElementById("sendBtn").addEventListener("click", sendMessage);
document.getElementById("message").addEventListener("keypress",(e)=>{
  if(e.key==="Enter") sendMessage();
});

</script>

</body>
</html>
